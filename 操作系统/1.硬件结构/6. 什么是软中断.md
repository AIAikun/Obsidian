# 什么是软中断
![[Pasted image 20250328102356.png]]
## 中断是什么？
操作系统收到了中断请求，会打断其他进程的运行，所以**中断请求的响应程序，也就是中断处理程序，要尽可能快的执行完，这样可以减少对正常进程运行调度地影响。**
而且，中断处理程序在响应中断时，可能还会「临时关闭中断」，这意味着，如果当前中断处理程序没有执行完之前，系统中其他的中断请求都无法被响应，也就说中断有可能会丢失，所以中断处理程序要短且快。
## 什么是软中断？
Linux 系统**为了解决中断处理程序执行过长和中断丢失的问题，将中断过程分成了两个阶段，分别是「上半部和下半部分」**。
- **上半部用来快速处理中断，处理硬件请求，也就是硬中断，由硬件触发中断**，一般会暂时关闭中断请求，主要负责处理跟硬件紧密相关或者时间敏感的事情，主要是负责耗时短的工作，特点是快速执行；
- **下半部用来延迟处理上半部未完成的工作，是由内核触发，也就说软中断**，一般以「内核线程」的方式运行，通常都是耗时比较长的事情，特点是延迟执行；
举一个计算机中的例子，常见的网卡接收网络包的例子。
网卡收到网络包后，通过 DMA 方式将接收到的数据写入内存，接着会通过**硬件中断**通知内核有新的数据到了，于是内核就会调用对应的中断处理程序来处理该事件，这个事件的处理也是会分成上半部和下半部。
上部分要做的事情很少，会先禁止网卡中断，避免频繁硬中断，而降低内核的工作效率。接着，内核会触发一个**软中断**，把一些处理比较耗时且复杂的事情，交给「软中断处理程序」去做，也就是中断的下半部，其主要是需要从内存中找到网络数据，再按照网络协议栈，对网络数据进行逐层解析和处理，最后把数据送给应用程序。
硬中断（上半部）是会打断 CPU 正在执行的任务，然后立即执行中断处理程序，而软中断（下半部）是以内核线程的方式执行，并且每一个 CPU 都对应一个软中断内核线程，名字通常为「ksoftirqd/CPU 编号」。
软中断不只是包括硬件设备中断处理程序的下半部，一些内核自定义事件也属于软中断。
